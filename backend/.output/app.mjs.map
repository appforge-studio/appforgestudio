{
  "version": 3,
  "sources": ["../.arri/__arri_app.ts", "../../env.ts", "../src/app.ts", "../src/services/mediaServer.ts", "../src/services/eventServer.ts", "../src/utils/chunkUploadManager.ts", "../src/procedures/admin/create_component.rpc.ts", "../src/utils/component_utils.ts", "../../database/postgres.ts", "../../database/schema/components.ts", "../../database/schema/common.ts", "../src/procedures/admin/create_type.rpc.ts", "../../database/schema/types.ts", "../src/utils/type_utils.ts", "../src/procedures/admin/get_components.rpc.ts", "../src/procedures/admin/get_types.rpc.ts", "../src/procedures/admin/save_type_code.rpc.ts", "../src/procedures/admin/update_component.rpc.ts", "../src/procedures/admin/update_type_definition.rpc.ts", "../src/procedures/ai/generate_design.rpc.ts", "../src/services/aiService.ts", "../../database/schema/svgs.ts", "../../database/schema/ai_cache.ts", "../../database/schema/ai_sessions.ts", "../src/procedures/ai/generate_image.rpc.ts", "../src/procedures/ai/inpaint_image.rpc.ts", "../src/procedures/ai/iterate_design.rpc.ts", "../src/procedures/svg/get_svgs.rpc.ts"],
  "sourcesContent": ["import sourceMapSupport from \"source-map-support\";\nsourceMapSupport.install();\nimport app from \"../src/app\";\nimport adminCreateComponent from \"./../src/procedures/admin/create_component.rpc\";\nimport adminCreateType from \"./../src/procedures/admin/create_type.rpc\";\nimport adminGetComponents from \"./../src/procedures/admin/get_components.rpc\";\nimport adminGetTypes from \"./../src/procedures/admin/get_types.rpc\";\nimport adminSaveTypeCode from \"./../src/procedures/admin/save_type_code.rpc\";\nimport adminUpdateComponent from \"./../src/procedures/admin/update_component.rpc\";\nimport adminUpdateTypeDefinition from \"./../src/procedures/admin/update_type_definition.rpc\";\nimport aiGenerateDesign from \"./../src/procedures/ai/generate_design.rpc\";\nimport aiGenerateImage from \"./../src/procedures/ai/generate_image.rpc\";\nimport aiInpaintImage from \"./../src/procedures/ai/inpaint_image.rpc\";\nimport aiIterateDesign from \"./../src/procedures/ai/iterate_design.rpc\";\nimport svgGetSvgs from \"./../src/procedures/svg/get_svgs.rpc\";\n\napp.rpc(\"admin.create_component\", adminCreateComponent);\napp.rpc(\"admin.create_type\", adminCreateType);\napp.rpc(\"admin.get_components\", adminGetComponents);\napp.rpc(\"admin.get_types\", adminGetTypes);\napp.rpc(\"admin.save_type_code\", adminSaveTypeCode);\napp.rpc(\"admin.update_component\", adminUpdateComponent);\napp.rpc(\"admin.update_type_definition\", adminUpdateTypeDefinition);\napp.rpc(\"ai.generate_design\", aiGenerateDesign);\napp.rpc(\"ai.generate_image\", aiGenerateImage);\napp.rpc(\"ai.inpaint_image\", aiInpaintImage);\napp.rpc(\"ai.iterate_design\", aiIterateDesign);\napp.rpc(\"svg.get_svgs\", svgGetSvgs);\n\nexport default app;\n", "import { config } from 'dotenv';\r\nimport { join, dirname } from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\n// Load environment variables from .env file in root directory\r\n// The env.ts file is compiled to .output, so we need to go up to the root\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = dirname(__filename);\r\n\r\n// Try loading from current directory (source mode) or from root relative to .output (build mode)\r\nconst possiblePaths = [\r\n    join(__dirname, '.env'),\r\n    join(__dirname, '..', '..', '.env'),\r\n];\r\n\r\nfor (const envPath of possiblePaths) {\r\n    config({ path: envPath });\r\n}\r\n\r\n// Export environment variables for use in other modules\r\nexport const DATABASE_URL = process.env['DATABASE_URL'];\r\nexport const JWT_SECRET = process.env['JWT_SECRET'];\r\nexport const SMTP_HOST = process.env['SMTP_HOST'];\r\nexport const SMTP_PORT = process.env['SMTP_PORT'];\r\nexport const SMTP_USER = process.env['SMTP_USER'];\r\nexport const SMTP_PASS = process.env['SMTP_PASS'];\r\nexport const FROM_EMAIL = process.env['FROM_EMAIL'];\r\nexport const FE_URL = process.env['FE_URL'];\r\nexport const GOOGLE_STUDIO_API_KEY = process.env['GOOGLE_STUDIO_API_KEY'];\r\nexport const ELEVEN_LABS_API_KEY = process.env['ELEVEN_LABS_API_KEY'];\r\nexport const AI_BASE_URL = process.env['AI_BASE_URL'];\r\n\r\nif (!DATABASE_URL) {\r\n    throw new Error('Missing required environment var DATABASE_URL');\r\n}\r\n\r\n// Export env object for compatibility\r\nexport const env = {\r\n    DATABASE_URL,\r\n    JWT_SECRET,\r\n    GOOGLE_STUDIO_API_KEY,\r\n};\r\n", "// Import environment variables first\r\nimport \"@env\";\r\n\r\nimport {\r\n  ArriApp,\r\n  defineRoute,\r\n  readMultipartFormData,\r\n  defineMiddleware,\r\n  getHeader,\r\n  readBody,\r\n  getRouterParam,\r\n} from \"@arrirpc/server\";\r\nimport { promises as fs } from 'node:fs';\r\nimport path from 'node:path';\r\nimport { mediaServer } from \"./services/mediaServer\";\r\nimport { EventServer } from \"./services/eventServer\";\r\nimport { chunkUploadManager } from \"./utils/chunkUploadManager\";\r\n\r\n// Initialize event server for real-time notifications\r\nEventServer.init();\r\n\r\nconst app = new ArriApp({\r\n  onError: (error, event) => {\r\n    console.error('\u274C APP ERROR:', error);\r\n    console.error('Stack trace:', error.stack);\r\n    console.error('Request:', event?.node?.req?.method, event?.node?.req?.url);\r\n    console.error('Headers:', event?.node?.req?.headers);\r\n  },\r\n  onRequest: (event) => {\r\n    console.log(\"\uD83D\uDCE5 Incoming request:\", event.node.req.method, event.node.req.url);\r\n\r\n    // Add CORS headers\r\n    const origin = event.node.req.headers.origin;\r\n    const allowedOrigins = [\r\n      \"http://192.168.141.133:3000\",\r\n      \"http://127.0.0.1:3000\",\r\n    ];\r\n\r\n    // Allow all localhost ports\r\n    const isLocalhost = origin?.startsWith('http://localhost:') || origin?.startsWith('http://127.0.0.1:');\r\n\r\n    if (origin && (isLocalhost || allowedOrigins.includes(origin))) {\r\n      event.node.res.setHeader(\"Access-Control-Allow-Origin\", origin);\r\n      event.node.res.setHeader(\"Vary\", \"Origin\");\r\n      event.node.res.setHeader(\"Access-Control-Allow-Credentials\", \"true\");\r\n    } else if (!origin) {\r\n      // Allow requests without origin (like from Postman or same-origin)\r\n      event.node.res.setHeader(\"Access-Control-Allow-Origin\", \"*\");\r\n    }\r\n\r\n    event.node.res.setHeader(\r\n      \"Access-Control-Allow-Methods\",\r\n      \"GET, POST, PUT, DELETE, OPTIONS\"\r\n    );\r\n    event.node.res.setHeader(\r\n      \"Access-Control-Allow-Headers\",\r\n      \"Content-Type, Authorization\"\r\n    );\r\n    event.node.res.setHeader(\"Access-Control-Max-Age\", \"86400\");\r\n\r\n    // Handle preflight requests\r\n    if (event.node.req.method === \"OPTIONS\") {\r\n      event.node.res.statusCode = 204;\r\n      event.node.res.end();\r\n      return;\r\n    }\r\n  },\r\n  disableDefinitionRoute: false,\r\n});\r\n\r\n// \u2705 Authentication middleware \u2014 injects event.context.user\r\nconst authMiddleware = defineMiddleware(async (event) => {\r\n  try {\r\n    const authHeader = getHeader(event, \"Authorization\");\r\n    console.log('\uD83D\uDD10 Auth middleware - Authorization header:', authHeader ? 'Present' : 'Missing');\r\n\r\n    if (authHeader) {\r\n      const decodedToken = JSON.parse(authHeader);\r\n      event.context.user = decodedToken;\r\n      console.log('\u2705 Auth middleware - User set:', { id: decodedToken.id, email: decodedToken.email });\r\n    } else {\r\n      console.log('\u26A0\uFE0F Auth middleware - No authorization header found');\r\n    }\r\n  } catch (err) {\r\n    console.error(\"\u274C Auth validation error:\", err);\r\n  }\r\n});\r\n\r\n// \u2705 Register the middleware\r\napp.use(authMiddleware);\r\n\r\n// \u2705 Media upload route\r\napp.route(\r\n  defineRoute({\r\n    path: \"/media/upload\",\r\n    method: [\"post\"],\r\n    handler: async (event) => {\r\n      console.log(\"Media upload route called\");\r\n      try {\r\n        // You now have event.context.user available here \uD83D\uDC47\r\n        const user = event.context.user;\r\n        console.log(\"User context:\", user);\r\n\r\n        // Use h3's readMultipartFormData with better error handling\r\n        const form = await readMultipartFormData(event).catch((parseError: any) => {\r\n          console.error(\"Multipart parsing error:\", parseError);\r\n\r\n          // If parsing fails due to size, provide helpful error message\r\n          if (parseError?.message?.includes('Invalid array length') ||\r\n            parseError?.message?.includes('Maximum call stack') ||\r\n            parseError?.message?.includes('out of memory')) {\r\n            throw new Error(\"File too large for processing. Please try a smaller file (under 50MB).\");\r\n          }\r\n\r\n          throw new Error(\"Failed to parse upload data: \" + (parseError?.message || 'Unknown error'));\r\n        });\r\n\r\n        console.log(\"Form received, length:\", form?.length);\r\n        console.log(\"All form parts:\", form?.map(p => ({ name: p.name, type: p.type, filename: p.filename, dataLength: p.data?.length })));\r\n\r\n        if (!form || form.length === 0) {\r\n          console.log(\"No form data received\");\r\n          return { success: false, message: \"No form data received\" };\r\n        }\r\n\r\n        const filePart = form.find((p) => p.name === \"file\");\r\n        const directoryField = form.find((p) => p.name === \"directory\");\r\n        const userIdField = form.find((p) => p.name === \"userId\");\r\n\r\n        console.log(\"File part:\", filePart ? { filename: filePart.filename, type: filePart.type, dataLength: filePart.data?.length } : null);\r\n        console.log(\"UserId field:\", userIdField?.data?.toString(\"utf8\"));\r\n        console.log(\"Directory field:\", directoryField?.data?.toString(\"utf8\"));\r\n\r\n        if (!filePart || !filePart.data || !filePart.filename) {\r\n          console.log(\"Missing file in multipart form-data\");\r\n          return {\r\n            success: false,\r\n            message: \"Missing file in multipart form-data\",\r\n          };\r\n        }\r\n\r\n        const directory =\r\n          user?.id || // \uD83E\uDDE9 automatically use the logged-in user\u2019s ID if available\r\n          userIdField?.data?.toString(\"utf8\") ||\r\n          directoryField?.data?.toString(\"utf8\");\r\n        console.log(\"Resolved directory:\", directory);\r\n\r\n        const result = await mediaServer.uploadMedia({\r\n          originalName: filePart.filename,\r\n          bytes: filePart.data,\r\n          contentType: filePart.type ?? undefined,\r\n          directory,\r\n        });\r\n        console.log(\"Upload result:\", result);\r\n\r\n        return {\r\n          success: true,\r\n          url: result.url,\r\n          rawUrl: result.rawUrl,\r\n          coverImageUrl: result.coverImageUrl,\r\n          duration: result.duration,\r\n        };\r\n      } catch (err: any) {\r\n        console.error(\"Upload error\", err);\r\n\r\n        // Provide more specific error messages\r\n        if (err?.message?.includes('Invalid array length') ||\r\n          err?.message?.includes('Maximum call stack') ||\r\n          err?.message?.includes('out of memory')) {\r\n          return {\r\n            success: false,\r\n            message: \"File too large to process. Please try a smaller file (under 50MB).\"\r\n          };\r\n        }\r\n\r\n        return { success: false, message: \"Upload failed: \" + (err?.message || 'Unknown error') };\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\n// \u2705 Chunked upload routes for large files\r\napp.route(\r\n  defineRoute({\r\n    path: \"/media/upload/init\",\r\n    method: [\"post\"],\r\n    handler: async (event) => {\r\n      console.log(\"Chunked upload initialization called\");\r\n      try {\r\n        const body = await readBody(event);\r\n        const { filename, totalChunks, directory, contentType } = body;\r\n\r\n        if (!filename || !totalChunks || !directory) {\r\n          return {\r\n            success: false,\r\n            message: \"Missing required parameters: filename, totalChunks, directory\"\r\n          };\r\n        }\r\n\r\n        const sessionId = await chunkUploadManager.initializeUpload(\r\n          filename,\r\n          parseInt(totalChunks),\r\n          directory,\r\n          contentType\r\n        );\r\n\r\n        return {\r\n          success: true,\r\n          sessionId,\r\n          message: \"Upload session initialized\"\r\n        };\r\n      } catch (err: any) {\r\n        console.error(\"Chunked upload init error:\", err);\r\n        return { success: false, message: \"Failed to initialize upload: \" + (err?.message || 'Unknown error') };\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\napp.route(\r\n  defineRoute({\r\n    path: \"/media/upload/chunk\",\r\n    method: [\"post\"],\r\n    handler: async (event) => {\r\n      console.log(\"Chunked upload chunk called\");\r\n      try {\r\n        const form = await readMultipartFormData(event).catch((parseError: any) => {\r\n          console.error(\"Chunk multipart parsing error:\", parseError);\r\n          throw new Error(\"Failed to parse chunk data: \" + (parseError?.message || 'Unknown error'));\r\n        });\r\n\r\n        if (!form || form.length === 0) {\r\n          return { success: false, message: \"No chunk data received\" };\r\n        }\r\n\r\n        const sessionIdField = form.find(p => p.name === \"sessionId\");\r\n        const chunkIndexField = form.find(p => p.name === \"chunkIndex\");\r\n        const chunkFile = form.find(p => p.name === \"chunk\");\r\n\r\n        if (!sessionIdField || !chunkIndexField || !chunkFile) {\r\n          return {\r\n            success: false,\r\n            message: \"Missing required fields: sessionId, chunkIndex, chunk\"\r\n          };\r\n        }\r\n\r\n        const sessionId = sessionIdField.data.toString('utf8');\r\n        const chunkIndex = parseInt(chunkIndexField.data.toString('utf8'));\r\n\r\n        const result = await chunkUploadManager.uploadChunk(\r\n          sessionId,\r\n          chunkIndex,\r\n          chunkFile.data\r\n        );\r\n\r\n        return result;\r\n      } catch (err: any) {\r\n        console.error(\"Chunked upload chunk error:\", err);\r\n        return { success: false, message: \"Failed to upload chunk: \" + (err?.message || 'Unknown error') };\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\napp.route(\r\n  defineRoute({\r\n    path: \"/media/upload/finalize\",\r\n    method: [\"post\"],\r\n    handler: async (event) => {\r\n      console.log(\"Chunked upload finalize called\");\r\n      try {\r\n        const body = await readBody(event);\r\n        const { sessionId, title, description } = body;\r\n\r\n        if (!sessionId) {\r\n          return { success: false, message: \"Missing sessionId\" };\r\n        }\r\n\r\n        const result = await chunkUploadManager.finalizeUpload(sessionId);\r\n\r\n        if (!result.success || !result.filePath) {\r\n          return result;\r\n        }\r\n\r\n        // Process the finalized file with mediaServer\r\n        const fileStats = await fs.stat(result.filePath);\r\n        const fileBuffer = await fs.readFile(result.filePath);\r\n        const filename = path.basename(result.filePath);\r\n        const directory = path.dirname(result.filePath).split(path.sep).pop() || 'default';\r\n\r\n        const mediaResult = await mediaServer.uploadMedia({\r\n          originalName: filename,\r\n          bytes: fileBuffer,\r\n          contentType: 'audio/mpeg', // Default to MP3, could be detected\r\n          directory,\r\n        });\r\n\r\n        // Clean up the temporary file\r\n        await fs.unlink(result.filePath);\r\n\r\n        return {\r\n          success: true,\r\n          message: \"Chunked upload completed successfully\",\r\n          url: mediaResult.url,\r\n          rawUrl: mediaResult.rawUrl,\r\n          coverImageUrl: mediaResult.coverImageUrl,\r\n          duration: mediaResult.duration,\r\n        };\r\n      } catch (err: any) {\r\n        console.error(\"Chunked upload finalize error:\", err);\r\n        return { success: false, message: \"Failed to finalize upload: \" + (err?.message || 'Unknown error') };\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\napp.route(\r\n  defineRoute({\r\n    path: \"/media/upload/progress/:sessionId\",\r\n    method: [\"get\"],\r\n    handler: async (event) => {\r\n      try {\r\n        const sessionId = getRouterParam(event, 'sessionId');\r\n        if (!sessionId) {\r\n          return { success: false, message: \"Missing sessionId\" };\r\n        }\r\n\r\n        const result = await chunkUploadManager.getUploadProgress(sessionId);\r\n        return result;\r\n      } catch (err: any) {\r\n        console.error(\"Upload progress error:\", err);\r\n        return { success: false, message: \"Failed to get progress: \" + (err?.message || 'Unknown error') };\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\n// \u2705 Static file serving route for uploads\r\napp.route(\r\n  defineRoute({\r\n    path: \"/uploads/**\",\r\n    method: [\"get\"],\r\n    handler: async (event) => {\r\n      console.log(\"Upload route handler called!\");\r\n      const url = event.node.req.url;\r\n      console.log(\"Full URL:\", url);\r\n\r\n      // Extract the path after /uploads/\r\n      const uploadPath = url!.replace('/uploads/', '');\r\n      const filePath = path.join(process.cwd(), 'uploads', uploadPath);\r\n      console.log(\"Requested file path:\", filePath);\r\n\r\n      try {\r\n        const stat = await fs.stat(filePath);\r\n        if (!stat.isFile()) {\r\n          event.node.res.statusCode = 404;\r\n          event.node.res.end(\"Not Found\");\r\n          return;\r\n        }\r\n\r\n        const ext = path.extname(filePath).toLowerCase();\r\n        const mimeTypes: Record<string, string> = {\r\n          '.png': 'image/png',\r\n          '.jpg': 'image/jpeg',\r\n          '.jpeg': 'image/jpeg',\r\n          '.gif': 'image/gif',\r\n          '.webp': 'image/webp',\r\n          '.mp4': 'video/mp4',\r\n          '.mov': 'video/quicktime',\r\n          '.m4v': 'video/x-m4v',\r\n          '.mp3': 'audio/mpeg',\r\n          '.wav': 'audio/wav',\r\n          '.ogg': 'audio/ogg',\r\n          '.heic': 'image/heic',\r\n          '.heif': 'image/heif',\r\n          '.pdf': 'application/pdf',\r\n          '.m3u8': 'application/x-mpegURL',\r\n          '.ts': 'video/MP2T',\r\n        };\r\n\r\n        const contentType = mimeTypes[ext] || 'application/octet-stream';\r\n        event.node.res.setHeader('Content-Type', contentType);\r\n        event.node.res.setHeader('Content-Length', stat.size);\r\n\r\n        const fileStream = await fs.readFile(filePath);\r\n        event.node.res.end(fileStream);\r\n      } catch (err) {\r\n        console.error(\"File read error:\", err);\r\n        event.node.res.statusCode = 404;\r\n        event.node.res.end(\"Not Found\");\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport default app;\r\n", "import { promises as fs } from 'node:fs';\r\nimport path from 'node:path';\r\nimport { randomUUID } from 'node:crypto';\r\nimport { execSync } from 'node:child_process';\r\nimport ffmpeg from 'fluent-ffmpeg';\r\n\r\nexport interface UploadResult {\r\n\turl: string;\r\n\trawUrl?: string;\r\n\tcoverImageUrl?: string;\r\n\tduration?: number; // Duration in seconds\r\n\tpath: string;\r\n\toriginalName: string;\r\n\tcontentType?: string;\r\n}\r\n\r\nexport interface UploadInput {\r\n    originalName: string;\r\n    bytes: Buffer;\r\n    contentType: string | undefined;\r\n    directory: string | undefined;\r\n}\r\n\r\nexport class MediaServer {\r\n\tprivate readonly uploadRoot: string;\r\n\r\n\tconstructor(uploadRootDir?: string) {\r\n\t\tthis.uploadRoot = uploadRootDir ?? path.resolve(process.cwd(), 'uploads');\r\n\t}\r\n\r\n\tpublic async uploadMedia(input: UploadInput): Promise<UploadResult> {\r\n\t\tconsole.log(\"got upload request\");\r\n\t\tconst { originalName, bytes, contentType, directory } = input;\r\n\t\tconst targetDir = directory ? path.join(this.uploadRoot, directory) : this.uploadRoot;\r\n\t\tawait this.ensureDirectory(targetDir);\r\n\r\n\t\tconst ext = this.getSafeExtension(originalName);\r\n\t\tconst fileName = `${randomUUID()}${ext}`;\r\n\t\tconst absolutePath = path.join(targetDir, fileName);\r\n\r\n\t\tawait fs.writeFile(absolutePath, bytes);\r\n\r\n\t\t// For audio files, convert to Opus and return both URLs\r\n\t\tif (this.isAudioFile(contentType, ext)) {\r\n\t\t\tconsole.log(\"Audio file detected, saving raw file\");\r\n\t\t\tconst rawFileUrl = `/uploads/${directory ? `${directory}/` : ''}${fileName}`;\r\n\r\n\t\t\tlet duration: number | undefined;\r\n\r\n\t\t\t// Extract audio duration if FFmpeg is available\r\n\t\t\tif (this.isFFmpegAvailable()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tduration = await this.getAudioDuration(absolutePath);\r\n\t\t\t\t\tconsole.log(\"Audio duration extracted:\", duration, \"milliseconds\");\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"Audio duration extraction failed:\", error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Skip Opus conversion if uploading to a 'raw' directory\r\n\t\t\tconst shouldConvertToOpus = !directory?.includes('raw');\r\n\r\n\t\t\tif (shouldConvertToOpus && this.isFFmpegAvailable()) {\r\n\t\t\t\tconsole.log(\"FFmpeg available, attempting Opus conversion\");\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst opusResult = await this.convertToOpus(absolutePath, targetDir, fileName);\r\n\t\t\t\t\tconsole.log(\"Opus conversion successful, returning both URLs\");\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\turl: opusResult.url,\r\n\t\t\t\t\t\trawUrl: rawFileUrl,\r\n\t\t\t\t\t\tduration,\r\n\t\t\t\t\t\tpath: opusResult.path,\r\n\t\t\t\t\t\toriginalName,\r\n\t\t\t\t\t\tcontentType: 'audio/ogg', // Opus in Ogg container\r\n\t\t\t\t\t};\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"Opus conversion failed, returning raw file URL as main URL:\", error);\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\turl: rawFileUrl,\r\n\t\t\t\t\t\trawUrl: rawFileUrl,\r\n\t\t\t\t\t\tduration,\r\n\t\t\t\t\t\tpath: absolutePath,\r\n\t\t\t\t\t\toriginalName,\r\n\t\t\t\t\t\t...(contentType !== undefined ? { contentType } : {}),\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"FFmpeg not available or raw upload, returning raw file URL\");\r\n\t\t\t\treturn {\r\n\t\t\t\t\turl: rawFileUrl,\r\n\t\t\t\t\trawUrl: rawFileUrl,\r\n\t\t\t\t\tduration,\r\n\t\t\t\t\tpath: absolutePath,\r\n\t\t\t\t\toriginalName,\r\n\t\t\t\t\t...(contentType !== undefined ? { contentType } : {}),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// For video files, return both HLS and raw URLs unless uploading to raw directory\r\n\t\tif (this.isVideoFile(contentType, ext)) {\r\n\t\t\tconsole.log(\"Video file detected, saving raw file\");\r\n\t\t\tconst rawFileUrl = `/uploads/${directory ? `${directory}/` : ''}${fileName}`;\r\n\r\n\t\t\tlet coverImageUrl: string | undefined;\r\n\t\t\tlet duration: number | undefined;\r\n\r\n\t\t\t// Extract cover image and duration if FFmpeg is available\r\n\t\t\tif (this.isFFmpegAvailable()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcoverImageUrl = await this.extractCoverImage(absolutePath, targetDir, fileName);\r\n\t\t\t\t\tconsole.log(\"Cover image extracted:\", coverImageUrl);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"Cover image extraction failed:\", error);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tduration = await this.getVideoDuration(absolutePath);\r\n\t\t\t\t\tconsole.log(\"Video duration extracted:\", duration, \"seconds\");\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"Duration extraction failed:\", error);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Skip HLS conversion if uploading to a 'raw' directory\r\n\t\t\tconst shouldConvertToHLS = !directory?.includes('raw');\r\n\r\n\t\t\tif (shouldConvertToHLS && this.isFFmpegAvailable()) {\r\n\t\t\t\tconsole.log(\"FFmpeg available, attempting HLS conversion\");\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst hlsResult = await this.convertToHLS(absolutePath, targetDir, fileName);\r\n\t\t\t\t\tconsole.log(\"HLS conversion successful, returning both URLs\");\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\turl: hlsResult.url,\r\n\t\t\t\t\t\trawUrl: rawFileUrl,\r\n\t\t\t\t\t\tcoverImageUrl,\r\n\t\t\t\t\t\tduration,\r\n\t\t\t\t\t\tpath: hlsResult.path,\r\n\t\t\t\t\t\toriginalName,\r\n\t\t\t\t\t\tcontentType: 'application/x-mpegURL', // HLS manifest MIME type\r\n\t\t\t\t\t};\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"HLS conversion failed, returning raw file URL as main URL:\", error);\r\n\t\t\t\t\t// Fall back to raw file as main URL if HLS conversion fails\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\turl: rawFileUrl,\r\n\t\t\t\t\t\trawUrl: rawFileUrl,\r\n\t\t\t\t\t\tcoverImageUrl,\r\n\t\t\t\t\t\tduration,\r\n\t\t\t\t\t\tpath: absolutePath,\r\n\t\t\t\t\t\toriginalName,\r\n\t\t\t\t\t\t...(contentType !== undefined ? { contentType } : {}),\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"FFmpeg not available or raw upload, returning raw file URL\");\r\n\t\t\t\treturn {\r\n\t\t\t\t\turl: rawFileUrl,\r\n\t\t\t\t\trawUrl: rawFileUrl,\r\n\t\t\t\t\tcoverImageUrl,\r\n\t\t\t\t\tduration,\r\n\t\t\t\t\tpath: absolutePath,\r\n\t\t\t\t\toriginalName,\r\n\t\t\t\t\t...(contentType !== undefined ? { contentType } : {}),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// For non-video files, return the original file URL\r\n\t\tconst fileUrl = `/uploads/${directory ? `${directory}/` : ''}${fileName}`;\r\n\r\n\t\treturn {\r\n\t\t\turl: fileUrl,\r\n\t\t\tpath: absolutePath,\r\n\t\t\toriginalName,\r\n\t\t\t...(contentType !== undefined ? { contentType } : {}),\r\n\t\t};\r\n\t}\r\n\r\n\tprivate async ensureDirectory(dir: string): Promise<void> {\r\n\t\ttry {\r\n\t\t\tawait fs.mkdir(dir, { recursive: true });\r\n\t\t} catch (_) {\r\n\t\t\t// noop: mkdir with recursive handles existing dirs\r\n\t\t}\r\n\t}\r\n\r\n\tprivate isVideoFile(contentType?: string, extension?: string): boolean {\r\n\t\tif (contentType && contentType.startsWith('video/')) return true;\r\n\t\tif (extension && /^\\.(mp4|mov|m4v|avi|mkv|webm|flv|wmv)$/.test(extension)) return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate isAudioFile(contentType?: string, extension?: string): boolean {\r\n\t\tif (contentType && contentType.startsWith('audio/')) return true;\r\n\t\tif (extension && /^\\.(mp3|wav|ogg|m4a|aac|flac|wma)$/.test(extension)) return true;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate isFFmpegAvailable(): boolean {\r\n\t\ttry {\r\n\t\t\texecSync('ffmpeg -version', { stdio: 'ignore' });\r\n\t\t\treturn true;\r\n\t\t} catch (error) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate async convertToHLS(inputPath: string, targetDir: string, fileName: string): Promise<UploadResult> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst baseName = path.parse(fileName).name;\r\n\t\t\tconst hlsDir = path.join(targetDir, baseName);\r\n\t\t\tconst manifestPath = path.join(hlsDir, 'playlist.m3u8');\r\n\r\n\t\t\tconsole.log('Starting HLS conversion...');\r\n\t\t\tconsole.log('Input path:', inputPath);\r\n\t\t\tconsole.log('HLS directory:', hlsDir);\r\n\t\t\tconsole.log('Manifest path:', manifestPath);\r\n\r\n\t\t\t// Ensure HLS directory exists\r\n\t\t\tthis.ensureDirectory(hlsDir).then(() => {\r\n\t\t\t\tconsole.log('HLS directory created, starting FFmpeg conversion');\r\n\r\n\t\t\t\t// Set FFmpeg path if available\r\n\t\t\t\ttry {\r\n\t\t\t\t\tffmpeg.setFfmpegPath('ffmpeg');\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.log('Using default FFmpeg path');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tffmpeg(inputPath)\r\n\t\t\t\t\t.inputOptions(['-hwaccel auto'])\r\n\t\t\t\t\t.outputOptions([\r\n\t\t\t\t\t\t'-c:v h264',\r\n\t\t\t\t\t\t'-c:a aac',\r\n\t\t\t\t\t\t'-b:v 1000k',\r\n\t\t\t\t\t\t'-b:a 128k',\r\n\t\t\t\t\t\t'-hls_time 10',\r\n\t\t\t\t\t\t'-hls_list_size 0',\r\n\t\t\t\t\t\t'-f hls',\r\n\t\t\t\t\t\t'-hls_segment_filename', path.join(hlsDir, 'segment_%03d.ts')\r\n\t\t\t\t\t])\r\n\t\t\t\t\t.output(manifestPath)\r\n\t\t\t\t\t.on('start', (commandLine: any) => {\r\n\t\t\t\t\t\tconsole.log('FFmpeg command: ' + commandLine);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('progress', (progress: any) => {\r\n\t\t\t\t\t\tconsole.log('FFmpeg progress: ' + progress.percent + '% done');\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('end', () => {\r\n\t\t\t\t\t\tconsole.log('HLS conversion completed successfully');\r\n\t\t\t\t\t\tconst hlsUrl = `/uploads/${path.relative(this.uploadRoot, hlsDir).replace(/\\\\/g, '/')}/playlist.m3u8`;\r\n\t\t\t\t\t\tconsole.log('HLS URL:', hlsUrl);\r\n\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\turl: hlsUrl,\r\n\t\t\t\t\t\t\tpath: manifestPath,\r\n\t\t\t\t\t\t\toriginalName: fileName,\r\n\t\t\t\t\t\t\tcontentType: 'application/x-mpegURL'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.on('error', (err: Error) => {\r\n\t\t\t\t\t\tconsole.error('HLS conversion failed:', err);\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.run();\r\n\t\t\t}).catch((err: Error) => {\r\n\t\t\t\tconsole.error('Failed to create HLS directory:', err);\r\n\t\t\t\treject(err);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async extractCoverImage(inputPath: string, targetDir: string, fileName: string): Promise<string> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst baseName = path.parse(fileName).name;\r\n\t\t\tconst coverImagePath = path.join(targetDir, `${baseName}_cover.jpg`);\r\n\r\n\t\t\tconsole.log('Extracting cover image...');\r\n\t\t\tconsole.log('Input path:', inputPath);\r\n\t\t\tconsole.log('Cover image path:', coverImagePath);\r\n\r\n\t\t\t// Set FFmpeg path if available\r\n\t\t\ttry {\r\n\t\t\t\tffmpeg.setFfmpegPath('ffmpeg');\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log('Using default FFmpeg path');\r\n\t\t\t}\r\n\r\n\t\t\tffmpeg(inputPath)\r\n\t\t\t\t.inputOptions(['-ss', '00:00:01']) // Seek to 1 second to avoid black frames\r\n\t\t\t\t.outputOptions(['-vframes', '1', '-q:v', '2']) // Extract 1 frame with high quality\r\n\t\t\t\t.output(coverImagePath)\r\n\t\t\t\t.on('start', (commandLine: any) => {\r\n\t\t\t\t\tconsole.log('FFmpeg cover extraction command: ' + commandLine);\r\n\t\t\t\t})\r\n\t\t\t\t.on('end', () => {\r\n\t\t\t\t\tconsole.log('Cover image extraction completed successfully');\r\n\t\t\t\t\tconst coverImageUrl = `/uploads/${path.relative(this.uploadRoot, coverImagePath).replace(/\\\\/g, '/')}`;\r\n\t\t\t\t\tconsole.log('Cover image URL:', coverImageUrl);\r\n\t\t\t\t\tresolve(coverImageUrl);\r\n\t\t\t\t})\r\n\t\t\t\t.on('error', (err: Error) => {\r\n\t\t\t\t\tconsole.error('Cover image extraction failed:', err);\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t})\r\n\t\t\t\t.run();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async getVideoDuration(inputPath: string): Promise<number> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tffmpeg.ffprobe(inputPath, (err, metadata) => {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst duration = metadata.format.duration;\r\n\t\t\t\tif (duration) {\r\n\t\t\t\t\tresolve(Math.round(duration));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new Error('Duration not found in video metadata'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async getAudioDuration(inputPath: string): Promise<number> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tffmpeg.ffprobe(inputPath, (err, metadata) => {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconst duration = metadata.format.duration;\r\n\t\t\t\tif (duration) {\r\n\t\t\t\t\tresolve(Math.round(duration * 1000)); // Return duration in milliseconds\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new Error('Duration not found in audio metadata'));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async convertToOpus(inputPath: string, targetDir: string, fileName: string): Promise<UploadResult> {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst baseName = path.parse(fileName).name;\r\n\t\t\tconst opusFileName = `${baseName}.opus`;\r\n\t\t\tconst opusPath = path.join(targetDir, opusFileName);\r\n\r\n\t\t\tconsole.log('Starting Opus conversion...');\r\n\t\t\tconsole.log('Input path:', inputPath);\r\n\t\t\tconsole.log('Output path:', opusPath);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tffmpeg.setFfmpegPath('ffmpeg');\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.log('Using default FFmpeg path');\r\n\t\t\t}\r\n\r\n\t\t\tffmpeg(inputPath)\r\n\t\t\t\t.audioCodec('libopus')\r\n\t\t\t\t.audioBitrate('64k')\r\n\t\t\t\t.audioChannels(1)\r\n\t\t\t\t.audioFrequency(48000)\r\n\t\t\t\t.outputOptions(['-vn']) // No video\r\n\t\t\t\t.output(opusPath)\r\n\t\t\t\t.on('start', (commandLine: any) => {\r\n\t\t\t\t\tconsole.log('FFmpeg command: ' + commandLine);\r\n\t\t\t\t})\r\n\t\t\t\t.on('progress', (progress: any) => {\r\n\t\t\t\t\tconsole.log('FFmpeg progress: ' + progress.percent + '% done');\r\n\t\t\t\t})\r\n\t\t\t\t.on('end', () => {\r\n\t\t\t\t\tconsole.log('Opus conversion completed successfully');\r\n\t\t\t\t\tconst opusUrl = `/uploads/${path.relative(this.uploadRoot, opusPath).replace(/\\\\/g, '/')}`;\r\n\t\t\t\t\tconsole.log('Opus URL:', opusUrl);\r\n\t\t\t\t\tresolve({\r\n\t\t\t\t\t\turl: opusUrl,\r\n\t\t\t\t\t\tpath: opusPath,\r\n\t\t\t\t\t\toriginalName: fileName,\r\n\t\t\t\t\t\tcontentType: 'audio/ogg'\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.on('error', (err: Error) => {\r\n\t\t\t\t\tconsole.error('Opus conversion failed:', err);\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t})\r\n\t\t\t\t.run();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate getSafeExtension(fileName: string): string {\r\n\t\tconst idx = fileName.lastIndexOf('.');\r\n\t\tif (idx === -1) return '';\r\n\t\tconst ext = fileName.slice(idx).toLowerCase();\r\n\t\t// Basic allowlist for common media types; fallback to empty if suspicious\r\n\t\tif (/^\\.(png|jpg|jpeg|gif|webp|mp4|mov|m4v|mp3|wav|ogg|m4a|aac|flac|opus|heic|heif|pdf)$/.test(ext)) return ext;\r\n\t\treturn '';\r\n\t}\r\n}\r\n\r\nexport const mediaServer = new MediaServer();\r\n\r\n\r\n", "import { createServer, IncomingMessage, ServerResponse } from \"http\";\r\nimport { Server, Socket } from \"socket.io\";\r\n\r\nexport class EventServer {\r\n  static httpServer: any;\r\n  static io: Server;\r\n  // static sockets: Record<string, Socket> = {};\r\n\r\n  static init() {\r\n    if (!EventServer.io) {\r\n      // Create a custom HTTP server that handles routes\r\n      EventServer.httpServer = createServer(\r\n        (req: IncomingMessage, res: ServerResponse) => {\r\n          if (req.url === \"/relay\" && req.method === \"POST\") {\r\n            let body = \"\";\r\n            req.on(\"data\", (chunk) => (body += chunk));\r\n            req.on(\"end\", () => {\r\n              console.log(body);\r\n              const { socketId, event, data } = JSON.parse(body);\r\n              this.io.to(socketId).emit(event, data);\r\n              res.writeHead(200, { \"Content-Type\": \"application/json\" });\r\n              res.end(JSON.stringify({ success: true }));\r\n            });\r\n          }\r\n        }\r\n      );\r\n\r\n      // Attach Socket.IO\r\n      EventServer.io = new Server(EventServer.httpServer, {\r\n        cors: { origin: \"*\" },\r\n      });\r\n\r\n      // Handle socket connections\r\n      EventServer.io.on(\"connection\", (socket) => {\r\n        console.log(\"Socket connected:\", socket.id);\r\n        \r\n        // Handle general events\r\n        socket.on(\"disconnect\", () => {\r\n          console.log(\"Socket disconnected:\", socket.id);\r\n        });\r\n        \r\n        // Pose-related events are handled by poseSocketService\r\n        // which listens to the same EventServer.io instance\r\n      });\r\n\r\n      EventServer.httpServer.on(\"error\", (err: any) => {\r\n        if (err.code === \"EADDRINUSE\") {\r\n          console.log(\"Port 5001 already in use\");\r\n        } else {\r\n          console.error(\"Error starting Socket.IO server:\", err);\r\n        }\r\n      });\r\n      EventServer.httpServer.listen(5001, () => {\r\n        console.log(\"Socket.IO + HTTP server running on port 5001\");\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport async function send(\r\n  socketId: string,\r\n  event: string,\r\n  data: unknown\r\n): Promise<void> {\r\n  const response = await fetch(\"http://192.168.1.13:5001/relay\", {\r\n    method: \"POST\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({ socketId: socketId, event: event, data: data }),\r\n  });\r\n  const result = await response.json();\r\n  console.log(result);\r\n}\r\n", "import { promises as fs } from 'node:fs';\r\nimport path from 'node:path';\r\nimport { ulid } from 'ulidx';\r\n\r\ninterface ChunkUploadSession {\r\n  id: string;\r\n  filename: string;\r\n  totalChunks: number;\r\n  uploadedChunks: Set<number>;\r\n  directory: string;\r\n  contentType?: string;\r\n  createdAt: Date;\r\n}\r\n\r\nclass ChunkUploadManager {\r\n  private sessions = new Map<string, ChunkUploadSession>();\r\n  private tempDir = path.join(process.cwd(), 'temp_uploads');\r\n\r\n  constructor() {\r\n    this.ensureTempDir();\r\n    // Clean up old sessions every hour\r\n    setInterval(() => this.cleanupOldSessions(), 60 * 60 * 1000);\r\n  }\r\n\r\n  private async ensureTempDir() {\r\n    try {\r\n      await fs.mkdir(this.tempDir, { recursive: true });\r\n    } catch (error) {\r\n      console.error('Failed to create temp directory:', error);\r\n    }\r\n  }\r\n\r\n  async initializeUpload(filename: string, totalChunks: number, directory: string, contentType?: string): Promise<string> {\r\n    const sessionId = ulid();\r\n    const session: ChunkUploadSession = {\r\n      id: sessionId,\r\n      filename,\r\n      totalChunks,\r\n      uploadedChunks: new Set(),\r\n      directory,\r\n      contentType,\r\n      createdAt: new Date(),\r\n    };\r\n\r\n    this.sessions.set(sessionId, session);\r\n    \r\n    // Create session directory\r\n    const sessionDir = path.join(this.tempDir, sessionId);\r\n    await fs.mkdir(sessionDir, { recursive: true });\r\n\r\n    console.log(`Initialized chunked upload session: ${sessionId} for file: ${filename} (${totalChunks} chunks)`);\r\n    return sessionId;\r\n  }\r\n\r\n  async uploadChunk(sessionId: string, chunkIndex: number, chunkData: Buffer): Promise<{ success: boolean; message: string; progress?: number }> {\r\n    const session = this.sessions.get(sessionId);\r\n    if (!session) {\r\n      return { success: false, message: 'Upload session not found' };\r\n    }\r\n\r\n    try {\r\n      const sessionDir = path.join(this.tempDir, sessionId);\r\n      const chunkPath = path.join(sessionDir, `chunk_${chunkIndex}`);\r\n      \r\n      await fs.writeFile(chunkPath, chunkData);\r\n      session.uploadedChunks.add(chunkIndex);\r\n\r\n      const progress = Math.round((session.uploadedChunks.size / session.totalChunks) * 100);\r\n      \r\n      console.log(`Uploaded chunk ${chunkIndex + 1}/${session.totalChunks} for session ${sessionId} (${progress}%)`);\r\n\r\n      return {\r\n        success: true,\r\n        message: `Chunk ${chunkIndex + 1}/${session.totalChunks} uploaded`,\r\n        progress\r\n      };\r\n    } catch (error) {\r\n      console.error(`Failed to upload chunk ${chunkIndex} for session ${sessionId}:`, error);\r\n      return { success: false, message: 'Failed to save chunk' };\r\n    }\r\n  }\r\n\r\n  async finalizeUpload(sessionId: string): Promise<{ success: boolean; message: string; filePath?: string }> {\r\n    const session = this.sessions.get(sessionId);\r\n    if (!session) {\r\n      return { success: false, message: 'Upload session not found' };\r\n    }\r\n\r\n    // Check if all chunks are uploaded\r\n    if (session.uploadedChunks.size !== session.totalChunks) {\r\n      return { \r\n        success: false, \r\n        message: `Missing chunks. Expected ${session.totalChunks}, got ${session.uploadedChunks.size}` \r\n      };\r\n    }\r\n\r\n    try {\r\n      const sessionDir = path.join(this.tempDir, sessionId);\r\n      const finalDir = path.join(process.cwd(), 'uploads', session.directory);\r\n      await fs.mkdir(finalDir, { recursive: true });\r\n\r\n      const finalFilePath = path.join(finalDir, session.filename);\r\n      const writeStream = await fs.open(finalFilePath, 'w');\r\n\r\n      // Combine chunks in order\r\n      for (let i = 0; i < session.totalChunks; i++) {\r\n        const chunkPath = path.join(sessionDir, `chunk_${i}`);\r\n        const chunkData = await fs.readFile(chunkPath);\r\n        await writeStream.write(chunkData);\r\n      }\r\n\r\n      await writeStream.close();\r\n\r\n      // Clean up session\r\n      await this.cleanupSession(sessionId);\r\n\r\n      console.log(`Finalized chunked upload: ${session.filename} (${session.totalChunks} chunks)`);\r\n      \r\n      return {\r\n        success: true,\r\n        message: 'File upload completed',\r\n        filePath: finalFilePath\r\n      };\r\n    } catch (error) {\r\n      console.error(`Failed to finalize upload for session ${sessionId}:`, error);\r\n      return { success: false, message: 'Failed to combine chunks' };\r\n    }\r\n  }\r\n\r\n  async getUploadProgress(sessionId: string): Promise<{ success: boolean; progress?: number; message: string }> {\r\n    const session = this.sessions.get(sessionId);\r\n    if (!session) {\r\n      return { success: false, message: 'Upload session not found' };\r\n    }\r\n\r\n    const progress = Math.round((session.uploadedChunks.size / session.totalChunks) * 100);\r\n    return {\r\n      success: true,\r\n      progress,\r\n      message: `${session.uploadedChunks.size}/${session.totalChunks} chunks uploaded`\r\n    };\r\n  }\r\n\r\n  private async cleanupSession(sessionId: string) {\r\n    try {\r\n      const sessionDir = path.join(this.tempDir, sessionId);\r\n      await fs.rm(sessionDir, { recursive: true, force: true });\r\n      this.sessions.delete(sessionId);\r\n    } catch (error) {\r\n      console.error(`Failed to cleanup session ${sessionId}:`, error);\r\n    }\r\n  }\r\n\r\n  private cleanupOldSessions() {\r\n    const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);\r\n    \r\n    for (const [sessionId, session] of this.sessions.entries()) {\r\n      if (session.createdAt < oneHourAgo) {\r\n        console.log(`Cleaning up old upload session: ${sessionId}`);\r\n        this.cleanupSession(sessionId);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const chunkUploadManager = new ChunkUploadManager();", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { createComponentFiles, registerComponent } from \"../../utils/component_utils\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { components } from \"@database/schema/components\";\r\nimport { ulid } from \"ulidx\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"CreateComponentParams\", {\r\n        name: a.string(), // e.g. \"heroHeader\" (enum value, folder name)\r\n        className: a.string(), // e.g. \"HeroHeader\" (class name prefix)\r\n        properties: a.array(\r\n            a.object({\r\n                name: a.string(),\r\n                type: a.string(),\r\n                initialValue: a.string(), // Passing as string for simplicity, parsed or used directly\r\n            })\r\n        ),\r\n        componentCode: a.optional(a.string()),\r\n    }),\r\n    response: a.object(\"CreateComponentResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n    }),\r\n    async handler({ params }) {\r\n        try {\r\n            const { name, className, properties: props, componentCode } = params;\r\n            // TODO: Add validation for name/className format\r\n\r\n            // Map the properties to match the interface if needed, currently matching structure\r\n            // initialValue is string, need to ensure it's treated correctly in utils\r\n\r\n            // 1. Create files\r\n            await createComponentFiles(name, className, props, componentCode || '');\r\n\r\n            // 2. Register\r\n            await registerComponent(name, className);\r\n\r\n            const db = getDrizzle();\r\n            await db.insert(components).values({\r\n                id: ulid(),\r\n                name,\r\n                className,\r\n                path: `/frontend/lib/components/${name}`, // Construct path\r\n                properties: JSON.stringify(props),\r\n                code: componentCode || '',\r\n            });\r\n\r\n            return {\r\n                success: true,\r\n                message: `Created component ${name}`,\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error creating component:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ? error.message : \"Failed to create component\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { promises as fs } from 'fs';\r\nimport { join, resolve } from 'path';\r\n\r\nfunction getProjectRoot(): string {\r\n  const cwd = process.cwd();\r\n  if (cwd.endsWith('backend')) {\r\n    return resolve(cwd, '..');\r\n  }\r\n  return cwd;\r\n}\r\n\r\nexport const COMPONENT_DIR_REL = './frontend/lib/components';\r\nexport const ENUMS_FILE_REL = './frontend/lib/models/enums.dart';\r\nexport const FACTORY_FILE_REL = './frontend/lib/components/component_properties_factory.dart';\r\nexport const COMPONENTS_EXPORT_FILE_REL = './frontend/lib/components/components.dart';\r\n\r\nexport interface ComponentProperty {\r\n  name: string;\r\n  type: 'string' | 'number' | 'boolean' | 'color' | 'icon';\r\n  initialValue: any;\r\n  group?: string;\r\n  displayName?: string;\r\n}\r\n\r\n// Helper to convert PascalCase/camelCase to snake_case for filenames if needed, \r\n// though we usually assume the component name passed in is already suitable for folder names.\r\n// But for class names, we usually start with upper case.\r\n\r\nfunction toPascalCase(str: string): string {\r\n  return str.replace(/(^\\w|-\\w)/g, clearAndUpper);\r\n}\r\n\r\n\r\nfunction fillTemplate(template: string, replacements: Record<string, string>): string {\r\n  return template.replace(/\\{\\{(\\w+)\\}\\}/g, (match, key) => {\r\n    return replacements[key] || match;\r\n  });\r\n}\r\n\r\nasync function readAndFillTemplate(templatePath: string, replacements: Record<string, string>): Promise<string> {\r\n  const template = await fs.readFile(templatePath, 'utf8');\r\n  return fillTemplate(template, replacements);\r\n}\r\n\r\nfunction clearAndUpper(text: string): string {\r\n  return text.replace(/-/, \"\").toUpperCase();\r\n}\r\n\r\n\r\n/**\r\n * Scans the frontend/lib/components directory and returns a list of available components.\r\n * A component is valid if it has a directory containing 'component.dart' and 'properties.dart'.\r\n */\r\nasync function getAvailableComponents(rootDir: string): Promise<{ name: string; className: string }[]> {\r\n  const componentsDir = join(rootDir, 'frontend', 'lib', 'components');\r\n\r\n  if (!await fs.stat(componentsDir).catch(() => false)) {\r\n    return [];\r\n  }\r\n\r\n  const entries = await fs.readdir(componentsDir, { withFileTypes: true });\r\n  const components: { name: string; className: string }[] = [];\r\n\r\n  for (const entry of entries) {\r\n    if (entry.isDirectory()) {\r\n      const compPath = join(componentsDir, entry.name);\r\n      try {\r\n        await fs.access(join(compPath, 'component.dart'));\r\n        await fs.access(join(compPath, 'properties.dart'));\r\n        // Assume className is PascalCase of directory name\r\n        components.push({ name: entry.name, className: toPascalCase(entry.name) });\r\n      } catch (e) {\r\n        // Not a valid component directory, skip\r\n      }\r\n    }\r\n  }\r\n\r\n  return components;\r\n}\r\n\r\n\r\nexport async function generateComponentFactories() {\r\n  const rootDir = getProjectRoot();\r\n  const components = await getAvailableComponents(rootDir);\r\n  const templatesDir = join(rootDir, 'backend', 'src', 'templates', 'components');\r\n\r\n  // Sort components for deterministic output\r\n  components.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n  // Data for Placeholders\r\n  const imports = components.map(c =>\r\n    `import '../components/${c.name}/component.dart';\\nimport '../components/${c.name}/properties.dart';`\r\n  ).join('\\n');\r\n\r\n  const componentTypeEnum = components.map(c => c.name).join(', ');\r\n\r\n  const casesCreateComponent = components.map(c =>\r\n    `      case ComponentType.${c.name}:\r\n        return ${c.className}Component(id: componentId, x: x, y: y);`\r\n  ).join('\\n');\r\n\r\n  const casesFromJson = components.map(c =>\r\n    `      case ComponentType.${c.name}:\r\n        return ${c.className}Component.fromJson(json);`\r\n  ).join('\\n');\r\n\r\n  const casesGetDefaultProperties = components.map(c =>\r\n    `      case ComponentType.${c.name}:\r\n        return createDefault${c.className}Properties();`\r\n  ).join('\\n');\r\n\r\n  // For property factory, it calls the static method directly on class\r\n  const casesGetDefaultPropertiesFactory = components.map(c =>\r\n    `      case ComponentType.${c.name}:\r\n        return ${c.className}Properties.createDefault();`\r\n  ).join('\\n');\r\n\r\n  const casesGetValidators = components.map(c =>\r\n    `      case ComponentType.${c.name}:\r\n        return ${c.className}Properties.validators;`\r\n  ).join('\\n');\r\n\r\n  const casesCreateWithProperties = components.map(c =>\r\n    `      case ComponentType.${c.name}:\r\n        return ${c.className}Component(\r\n          id: componentId,\r\n          x: x,\r\n          y: y,\r\n          properties: properties,\r\n        );`\r\n  ).join('\\n');\r\n\r\n  const utilityMethods = components.map(c =>\r\n    `  static ComponentProperties createDefault${c.className}Properties() {\r\n    return ${c.className}Properties.createDefault();\r\n  }`\r\n  ).join('\\n\\n');\r\n\r\n  const exports = components.map(c => `export '${c.name}/component.dart';`).join('\\n');\r\n\r\n  // 1. Generate frontend/lib/components/component_factory.dart\r\n  const componentFactoryContent = await readAndFillTemplate(join(templatesDir, 'component_factory.dart.tpl'), {\r\n    IMPORTS: imports,\r\n    COMPONENT_TYPE_ENUM: componentTypeEnum,\r\n    CASES_CREATE_COMPONENT: casesCreateComponent,\r\n    CASES_FROM_JSON: casesFromJson,\r\n    UTILITY_METHODS: utilityMethods,\r\n    CASES_GET_DEFAULT_PROPERTIES: casesGetDefaultProperties,\r\n    CASES_CREATE_WITH_PROPERTIES: casesCreateWithProperties\r\n  });\r\n\r\n  // 2. Generate frontend/lib/components/component_properties_factory.dart\r\n  const propertiesFactoryImports = components.map(c => `import '${c.name}/properties.dart';`).join('\\n');\r\n  const componentPropertiesFactoryContent = await readAndFillTemplate(join(templatesDir, 'component_properties_factory.dart.tpl'), {\r\n    IMPORTS: propertiesFactoryImports,\r\n    CASES_GET_DEFAULT_PROPERTIES: casesGetDefaultPropertiesFactory,\r\n    CASES_GET_VALIDATORS: casesGetValidators\r\n  });\r\n\r\n  // 3. Generate frontend/lib/components/components.dart (Exports)\r\n  const componentsExportContent = await readAndFillTemplate(join(templatesDir, 'components.dart.tpl'), {\r\n    EXPORTS: exports\r\n  });\r\n\r\n  const factoryPath = join(rootDir, 'frontend', 'lib', 'components', 'component_factory.dart');\r\n  const propertiesFactoryPath = join(rootDir, 'frontend', 'lib', 'components', 'component_properties_factory.dart');\r\n  const exportsPath = join(rootDir, 'frontend', 'lib', 'components', 'components.dart');\r\n\r\n  await fs.writeFile(factoryPath, componentFactoryContent);\r\n  await fs.writeFile(propertiesFactoryPath, componentPropertiesFactoryContent);\r\n  await fs.writeFile(exportsPath, componentsExportContent);\r\n}\r\n\r\nexport interface CreateComponentOptions {\r\n  name: string;\r\n  className: string;\r\n  properties?: ComponentProperty[];\r\n  componentCode?: string;\r\n  isResizable?: boolean;\r\n}\r\n\r\nexport async function createComponentFiles(options: CreateComponentOptions) {\r\n  const { name, className, properties = [], componentCode = '', isResizable = true } = options;\r\n  const rootDir = getProjectRoot();\r\n  const componentDir = join(rootDir, 'frontend', 'lib', 'components', name);\r\n  const templatesDir = join(rootDir, 'backend', 'src', 'templates', 'components');\r\n\r\n  // Create directory\r\n  await fs.mkdir(componentDir, { recursive: true });\r\n\r\n  // Generate Properties Code\r\n  const propertiesCode = properties.map(prop => {\r\n    const displayName = prop.displayName || prop.name;\r\n    switch (prop.type) {\r\n      case 'string':\r\n        return `      const StringProperty(\r\n        key: '${prop.name}',\r\n        displayName: '${displayName}',\r\n        value: '${prop.initialValue}',\r\n        group: '${prop.group ?? 'General'}',\r\n        enable: Enabled(show: true, enabled: true),\r\n      ),`;\r\n      case 'number':\r\n        return `      const NumberProperty(\r\n        key: '${prop.name}',\r\n        displayName: '${displayName}',\r\n        value: ${prop.initialValue},\r\n        min: 0.0,\r\n        max: 1000.0,\r\n        group: '${prop.group ?? 'General'}',\r\n        enable: Enabled(show: true, enabled: true),\r\n      ),`;\r\n      case 'boolean':\r\n        return `      const BooleanProperty(\r\n        key: '${prop.name}',\r\n        displayName: '${displayName}',\r\n        value: ${prop.initialValue},\r\n        group: '${prop.group ?? 'General'}',\r\n        enable: Enabled(show: true, enabled: true),\r\n      ),`;\r\n      case 'color':\r\n        return `      const ComponentColorProperty(\r\n        key: '${prop.name}',\r\n        displayName: '${displayName}',\r\n        value: XDColor(\r\n             ['${prop.initialValue}'],\r\n             type: ColorType.solid,\r\n             stops: [],\r\n             begin: Alignment.topLeft,\r\n             end: Alignment.bottomRight,\r\n         ),\r\n        enable: Enabled(show: true, enabled: true),\r\n        group: '${prop.group ?? 'General'}',\r\n      ),`;\r\n      case 'icon':\r\n        return `      const IconProperty(\r\n            key: '${prop.name}',\r\n            displayName: '${displayName}',\r\n            value: '${prop.initialValue}',\r\n            group: '${prop.group ?? 'General'}',\r\n            enable: Enabled(show: false, enabled: true),\r\n          ),`;\r\n      default:\r\n        return '';\r\n    }\r\n  }).join('\\n');\r\n\r\n  // Generate Validation Logic\r\n  const validationLogic = `static Map<String, String? Function(dynamic)> get validators => {\r\n${properties.map(prop => {\r\n    switch (prop.type) {\r\n      case 'string':\r\n      case 'icon':\r\n        return `    '${prop.name}': (value) => value is String ? null : '${prop.name} must be a string',`;\r\n      case 'number':\r\n        return `    '${prop.name}': (value) => value is num ? null : '${prop.name} must be a number',`;\r\n      case 'boolean':\r\n        return `    '${prop.name}': (value) => value is bool ? null : '${prop.name} must be a boolean',`;\r\n      case 'color':\r\n        return `    '${prop.name}': (value) {\r\n      if (value is XDColor) return null;\r\n      if (value is String && (value.startsWith('#') || value.startsWith('0x'))) return null;\r\n      if (value is Map && value.containsKey('value')) return null; // JSON structure for color\r\n      return '${prop.name} must be a valid color (Hex string, XDColor, or JSON object)';\r\n    },`;\r\n      default:\r\n        return `    '${prop.name}': (value) => null,`;\r\n    }\r\n  }).join('\\n')}\r\n  };`;\r\n\r\n  // component.dart content\r\n  let componentContent = componentCode;\r\n\r\n  if (!componentContent || componentContent.trim().length === 0) {\r\n    componentContent = await readAndFillTemplate(join(templatesDir, 'component_class.dart.tpl'), {\r\n      CLASS_NAME: className,\r\n      COMPONENT_NAME: name,\r\n      IS_RESIZABLE: isResizable.toString()\r\n    });\r\n  }\r\n\r\n  // properties.dart content\r\n  const propertiesContent = await readAndFillTemplate(join(templatesDir, 'component_properties.dart.tpl'), {\r\n    CLASS_NAME: className,\r\n    PROPERTIES_CODE: propertiesCode,\r\n    VALIDATION_LOGIC: validationLogic\r\n  });\r\n\r\n  await fs.writeFile(join(componentDir, 'component.dart'), componentContent);\r\n  await fs.writeFile(join(componentDir, 'properties.dart'), propertiesContent);\r\n}\r\n\r\nexport async function registerComponent(name: string, className: string) {\r\n  // Instead of patching logic, we just regenerate the factories\r\n  await generateComponentFactories();\r\n}\r\n", "import { drizzle } from \"drizzle-orm/postgres-js\";\r\nimport postgres from \"postgres\";\r\nimport type { PostgresJsDatabase } from \"drizzle-orm/postgres-js\";\r\nimport { DATABASE_URL } from \"@env\";\r\n\r\n// Database connection string from environment variable\r\n\r\n// Export the client for manual queries if needed\r\nlet db: PostgresJsDatabase | undefined;\r\nlet client: postgres.Sql | undefined;\r\n\r\n// Function to get drizzle instance\r\nexport function getDrizzle(): PostgresJsDatabase {\r\n  if (db) return db;\r\n  \r\n  if (!client) {\r\n    client = postgres(DATABASE_URL!);\r\n  }\r\n  \r\n  db = drizzle(client);\r\n  return db;\r\n}\r\n\r\n// Function to close the database connection\r\nexport function closeDatabase(): void {\r\n  if (client) {\r\n    client.end();\r\n    client = undefined;\r\n    db = undefined;\r\n  }\r\n}\r\n", "import { pgTable, text, varchar, boolean } from 'drizzle-orm/pg-core';\r\nimport { ulidField, defaultDateFields } from './common';\r\n\r\nexport const components = pgTable('components', {\r\n    id: ulidField('id').primaryKey(),\r\n    name: varchar('name', { length: 255 }).notNull().unique(),\r\n    className: varchar('class_name', { length: 255 }).notNull(),\r\n    path: text('path').notNull(),\r\n    properties: text('properties').notNull().default(\"[]\"), // JSON string type definition\r\n    code: text('code').notNull().default(\"\"),\r\n    isDefault: boolean('is_default').notNull().default(false),\r\n    isResizable: boolean('is_resizable').notNull().default(true),\r\n    ...defaultDateFields,\r\n});\r\n\r\nexport type Component = typeof components.$inferSelect;\r\nexport type NewComponent = typeof components.$inferInsert;\r\n", "import { timestamp, varchar } from 'drizzle-orm/pg-core';\r\n\r\nexport const ulidField = (name: string) => varchar(name, { length: 36 });\r\n\r\nexport const defaultDateFields = {\r\n    createdAt: timestamp('created_at', { mode: 'date' }).notNull().defaultNow(),\r\n    updatedAt: timestamp('updated_at', { mode: 'date' })\r\n        .notNull()\r\n        .$onUpdate(() => new Date())\r\n        .defaultNow(),\r\n};\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { types } from \"@database/schema/types\";\r\nimport { ulid } from \"ulidx\";\r\nimport { resolveTypePath, generateTypeContent, writeTypeFile } from \"../../utils/type_utils\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"CreateTypeParams\", {\r\n        name: a.string(),\r\n        className: a.string(),\r\n        structure: a.string(), // 'object' | 'enum'\r\n    }),\r\n    response: a.object(\"CreateTypeResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n    }),\r\n    async handler({ params }) {\r\n        try {\r\n            const db = getDrizzle();\r\n            const structure = params.structure === 'enum' ? 'enum' : 'object';\r\n\r\n            const { absolutePath, relativePath } = resolveTypePath(params.name, structure);\r\n\r\n            const content = generateTypeContent(params.className, structure, [\"placeholder\"], \"\"); // Initial placeholder for enum\r\n\r\n            await writeTypeFile(absolutePath, content);\r\n\r\n            await db.insert(types).values({\r\n                id: ulid(),\r\n                name: params.name,\r\n                className: params.className,\r\n                path: relativePath,\r\n                structure: structure,\r\n                enumValues: structure === 'enum' ? '[\"placeholder\"]' : null,\r\n            });\r\n\r\n            return {\r\n                success: true,\r\n                message: `Created ${params.name}`,\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error creating type:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ?\r\n                    `Failed: ${error.message} (CWD: ${process.cwd()})` :\r\n                    \"Failed to create type\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { pgTable, text, varchar, boolean } from 'drizzle-orm/pg-core';\r\nimport { ulidField, defaultDateFields } from './common';\r\n\r\nexport const types = pgTable('types', {\r\n    id: ulidField('id').primaryKey(),\r\n    name: varchar('name', { length: 255 }).notNull().unique(),\r\n    className: varchar('class_name', { length: 255 }).notNull(),\r\n    path: text('path').notNull(),\r\n    structure: varchar('structure', { length: 50 }).notNull().default('object'), // 'object' | 'enum'\r\n    enumValues: text('enum_values'), // JSON string array for enum values\r\n    isDefault: boolean('is_default').notNull().default(false),\r\n    ...defaultDateFields,\r\n});\r\n\r\nexport type Type = typeof types.$inferSelect;\r\nexport type NewType = typeof types.$inferInsert;\r\n", "import { resolve, join, dirname } from \"path\";\r\nimport { mkdir, writeFile } from \"fs/promises\";\r\n\r\nfunction getProjectRoot(): string {\r\n    const cwd = process.cwd();\r\n    if (cwd.endsWith('backend')) {\r\n        return resolve(cwd, '..');\r\n    }\r\n    return cwd;\r\n}\r\n\r\nexport function resolveTypePath(name: string, structure: string) {\r\n    // Structure: 'enum' | 'object'\r\n    const subDir = structure === 'enum' ? 'enums' : 'objects';\r\n    const rootDir = getProjectRoot();\r\n\r\n    // Go up into frontend\r\n    const absoluteDir = resolve(rootDir, `./frontend/lib/models/${subDir}`);\r\n    const absolutePath = join(absoluteDir, `${name}.dart`);\r\n\r\n    // Path relative to project root\r\n    const relativePath = `/frontend/lib/models/${subDir}/${name}.dart`;\r\n\r\n    return { absolutePath, relativePath };\r\n}\r\n\r\nexport function generateTypeContent(className: string, structure: string, enumValues: string[] = [], rawCode: string = \"\"): string {\r\n    if (structure === 'enum') {\r\n        const values = enumValues.length > 0 ? enumValues : ['placeholder'];\r\n        return `enum ${className} {\\n${values.map(v => `  ${v},`).join('\\n')}\\n}`;\r\n    } else {\r\n        return rawCode || `class ${className} {\r\n  final String id;\r\n  // Add properties here\r\n  \r\n  const ${className}({required this.id});\r\n}`;\r\n    }\r\n}\r\n\r\nexport async function writeTypeFile(absolutePath: string, content: string) {\r\n    await mkdir(dirname(absolutePath), { recursive: true });\r\n    await writeFile(absolutePath, content, 'utf8');\r\n}\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { components } from \"@database/schema/components\";\r\nimport { readFile } from \"fs/promises\";\r\nimport { resolve, join } from \"path\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"GetComponentsParams\", {}),\r\n    response: a.object(\"GetComponentsResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n        components: a.array(\r\n            a.object(\"ComponentInfo\", {\r\n                id: a.string(),\r\n                name: a.string(),\r\n                className: a.string(),\r\n                path: a.string(),\r\n                properties: a.string(), // JSON string of properties\r\n                code: a.string(),\r\n            })\r\n        ),\r\n    }),\r\n    async handler({ }) {\r\n        try {\r\n            const db = getDrizzle();\r\n            const dbComponents = await db.select().from(components);\r\n\r\n            const enhancedComponents = dbComponents.map((c) => {\r\n                return {\r\n                    id: c.id,\r\n                    name: c.name,\r\n                    className: c.className,\r\n                    path: c.path,\r\n                    properties: c.properties || \"[]\",\r\n                    code: c.code || \"\",\r\n                };\r\n            });\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Fetched components successfully\",\r\n                components: enhancedComponents,\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error fetching components:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ? error.message : \"Failed to fetch components\",\r\n                components: [], // Fallback? Or we could throw/return error state strictly.\r\n            };\r\n        }\r\n    },\r\n});\r\n\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { types } from \"@database/schema/types\";\r\nimport { desc } from \"drizzle-orm\";\r\nimport { readFile } from \"fs/promises\";\r\nimport { join, resolve } from \"path\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"GetTypesParams\", {}),\r\n    response: a.object(\"GetTypesResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n        types: a.array(\r\n            a.object(\"Type\", {\r\n                id: a.string(),\r\n                name: a.string(),\r\n                className: a.string(),\r\n                path: a.string(),\r\n                code: a.string(),\r\n                structure: a.string(),\r\n                enumValues: a.string(), // JSON string\r\n                createdAt: a.string(),\r\n                updatedAt: a.string(),\r\n            })\r\n        ),\r\n    }),\r\n    async handler({ }) {\r\n        try {\r\n            const db = getDrizzle();\r\n            const allTypes = await db.select().from(types).orderBy(desc(types.createdAt));\r\n\r\n            const typesWithCode = await Promise.all(allTypes.map(async (t) => {\r\n                let code = \"\";\r\n                try {\r\n                    // Stored path example: /frontend/lib/models/enums/status.dart\r\n                    // We need to resolve this relative to the project root (.. from backend)\r\n\r\n                    // t.path contains path relative to project root\r\n                    // resolve(process.cwd(), '..', t.path.replace(/^\\//,''))\r\n\r\n                    const projectRoot = resolve(process.cwd(), '..');\r\n                    const relativePath = t.path.startsWith('/') ? t.path.slice(1) : t.path;\r\n                    const codePath = resolve(projectRoot, relativePath);\r\n\r\n                    code = await readFile(codePath, 'utf8');\r\n                } catch (e) {\r\n                    // File might not exist\r\n                }\r\n\r\n                return {\r\n                    id: t.id,\r\n                    name: t.name,\r\n                    className: t.className,\r\n                    path: t.path,\r\n                    code: code,\r\n                    structure: t.structure,\r\n                    enumValues: t.enumValues ?? \"[]\",\r\n                    createdAt: t.createdAt.toISOString(),\r\n                    updatedAt: t.updatedAt.toISOString(),\r\n                };\r\n            }));\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Types fetched successfully\",\r\n                types: typesWithCode,\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error fetching types:\", error);\r\n            return {\r\n                success: false,\r\n                message: \"Failed to fetch types\",\r\n                types: [],\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { types } from \"@database/schema/types\";\r\nimport { eq } from \"drizzle-orm\";\r\nimport { writeFile, mkdir } from \"fs/promises\";\r\nimport { join, resolve } from \"path\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"SaveTypeCodeParams\", {\r\n        typeId: a.string(),\r\n        code: a.string(),\r\n    }),\r\n    response: a.object(\"SaveTypeCodeResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n    }),\r\n    async handler({ params }) {\r\n        try {\r\n            const db = getDrizzle();\r\n            const [type] = await db.select().from(types).where(eq(types.id, params.typeId));\r\n\r\n            if (!type) {\r\n                return {\r\n                    success: false,\r\n                    message: \"Type not found\",\r\n                };\r\n            }\r\n\r\n            const frontendModelsDir = resolve(process.cwd(), '../frontend/lib/models/types');\r\n            await mkdir(frontendModelsDir, { recursive: true });\r\n\r\n            const codePath = join(frontendModelsDir, `${type.name}.dart`);\r\n            await writeFile(codePath, params.code, 'utf8');\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Code saved successfully\",\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error saving code:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ? error.message : \"Failed to save code\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { components } from \"@database/schema/components\";\r\nimport { createComponentFiles } from \"../../utils/component_utils\";\r\nimport { eq } from \"drizzle-orm\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"UpdateComponentParams\", {\r\n        id: a.string(),\r\n        properties: a.array(\r\n            a.object({\r\n                name: a.string(),\r\n                type: a.stringEnum([\"string\", \"number\", \"boolean\", \"color\"]),\r\n                initialValue: a.string(),\r\n            })\r\n        ),\r\n        componentCode: a.string(),\r\n    }),\r\n    response: a.object(\"UpdateComponentResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n    }),\r\n    async handler({ params }) {\r\n        try {\r\n            const { id, properties, componentCode } = params;\r\n            const db = getDrizzle();\r\n\r\n            const existing = await db.select().from(components).where(eq(components.id, id)).limit(1);\r\n            if (!existing.length) {\r\n                return { success: false, message: \"Component not found\" };\r\n            }\r\n            const component = existing[0];\r\n\r\n            // 1. Update files\r\n            // createComponentFiles overwrites if files exist, which is what we want\r\n            await createComponentFiles(component.name, component.className, properties, componentCode);\r\n\r\n            // 2. Update DB\r\n            await db.update(components)\r\n                .set({\r\n                    properties: JSON.stringify(properties),\r\n                    code: componentCode,\r\n                })\r\n                .where(eq(components.id, id));\r\n\r\n            return {\r\n                success: true,\r\n                message: `Updated component ${component.name}`,\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error updating component:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ? error.message : \"Failed to update component\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { types } from \"@database/schema/types\";\r\nimport { eq } from \"drizzle-orm\";\r\nimport { resolveTypePath, generateTypeContent, writeTypeFile } from \"../../utils/type_utils\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"UpdateTypeDefinitionParams\", {\r\n        typeId: a.string(),\r\n        code: a.string(),\r\n        enumValues: a.string(),\r\n        structure: a.string(),\r\n    }),\r\n    response: a.object(\"UpdateTypeDefinitionResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n    }),\r\n    async handler({ params }) {\r\n        try {\r\n            const db = getDrizzle();\r\n            const [type] = await db.select().from(types).where(eq(types.id, params.typeId));\r\n\r\n            if (!type) {\r\n                return {\r\n                    success: false,\r\n                    message: \"Type not found\",\r\n                };\r\n            }\r\n\r\n            // AUTO-CORRECTION LOGIC:\r\n            // Always resolve path based on current structure preference, ignorning potentially stale DB path.\r\n            // This fixes \"legacy\" types created before the folder split.\r\n            const structure = params.structure === 'enum' ? 'enum' : 'object';\r\n            const { absolutePath, relativePath } = resolveTypePath(type.name, structure);\r\n\r\n            const values: string[] = JSON.parse(params.enumValues || \"[]\");\r\n            const content = generateTypeContent(type.className, structure, values, params.code);\r\n\r\n            await writeTypeFile(absolutePath, content);\r\n\r\n            // Update DB (including path if it changed!)\r\n            await db.update(types)\r\n                .set({\r\n                    enumValues: params.enumValues,\r\n                    path: relativePath,\r\n                    structure: structure // Ensure structure is updated if switched (though UI might not allow switching easily)\r\n                })\r\n                .where(eq(types.id, params.typeId));\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Type updated successfully\",\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error updating type definition:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ? `${error.message}` : \"Failed to update type\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { defineRpc } from \"@arrirpc/server\";\r\nimport { a } from \"@arrirpc/schema\";\r\nimport { AiService } from \"../../services/aiService\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"GenerateDesignParams\", {\r\n        prompt: a.string(),\r\n        sessionId: a.string(), // Changed from optional to avoid generator bug\r\n    }),\r\n    response: a.object(\"GenerateDesignResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(), // Changed from nullable\r\n        data: a.any(),\r\n    }),\r\n    handler: async ({ params }) => {\r\n        try {\r\n            const effectiveSessionId = params.sessionId || undefined;\r\n            const designJson = await AiService.generateDesign(params.prompt, effectiveSessionId);\r\n            const responseStr = JSON.stringify(designJson);\r\n            console.log(`\u2705 Design generated. Size: ${(responseStr.length / 1024).toFixed(2)} KB`);\r\n            return {\r\n                success: true,\r\n                data: designJson,\r\n                message: \"\"\r\n            };\r\n        } catch (error: any) {\r\n            console.error(\"Design generation failed:\", error);\r\n            return {\r\n                success: false,\r\n                message: error.message || \"Unknown error occurred during generation\",\r\n                data: null\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { env } from \"@env\";\nimport { getDrizzle } from \"@database/postgres\";\nimport { components } from \"@database/schema/components\";\nimport { svgs } from \"@database/schema/svgs\";\nimport { aiDesignCache } from \"@database/schema/ai_cache\";\nimport { aiDesignSessions, aiDesignMessages } from \"@database/schema/ai_sessions\";\nimport { eq, asc } from \"drizzle-orm\";\nimport { ulid } from \"ulidx\";\n\nexport class AiService {\n  private static genAI = new GoogleGenerativeAI(env.GOOGLE_STUDIO_API_KEY || '');\n\n  static async generateDesign(prompt: string, sessionId?: string, isIteration: boolean = false): Promise<any> {\n    const model = this.genAI.getGenerativeModel({\n      model: \"gemini-flash-latest\",\n      generationConfig: {\n        responseMimeType: \"application/json\",\n      }\n    });\n    const db = getDrizzle();\n    const allComponents = await db.select().from(components);\n    const allSvgs = await db.select({ name: svgs.name }).from(svgs);\n\n    const componentTypesList = allComponents.map(c => `\"${c.name}\"`).join(' | ');\n    const svgNamesList = allSvgs.map(s => `\"${s.name}\"`).join(', ');\n\n    const dynamicPropertiesSchema = allComponents.map((comp: any) => {\n      let props: any[] = [];\n      try {\n        props = JSON.parse(comp.properties);\n      } catch (e) {\n        return \"\";\n      }\n\n      const propLines = props.map((p: any) => {\n        let typeDesc = \"any\";\n        switch (p.type) {\n          case 'string': typeDesc = 'string'; break;\n          case 'number': typeDesc = 'double'; break;\n          case 'boolean': typeDesc = 'boolean'; break;\n          case 'color': typeDesc = '\"#AARRGGBB\" (Hex String)'; break;\n          case 'icon': typeDesc = 'string (Material Icon name)'; break;\n          default: typeDesc = 'any';\n        }\n        // MODIFIED: Request simple value directly instead of { value, enable } object\n        return `\"${p.name}\": ${typeDesc}`;\n      }).join(',\\n        ');\n\n      return `// PROPERTIES FOR \"${comp.name}\"\\n        ${propLines}`;\n    }).join('\\n\\n        ');\n\n    const schemaDescription = `\n    You are a UI design generator. Output strictly valid JSON matching this schema for a Flutter app design canvas.\n    \n    ROOT OBJECT:\n    {\n      \"components\": [ ... list of component objects ... ],\n      \"canvasSize\": { \"width\": 375.0, \"height\": 812.0 }, // Standard mobile size\n      \"selectedComponent\": null, // Always null initially\n      \"isDragging\": false,\n      \"isPropertyEditorVisible\": false\n    }\n\n    COMPONENT OBJECT:\n    {\n      \"id\": \"unique_string_id\",\n      \"type\": ${componentTypesList},\n      \"x\": double (position),\n      \"y\": double (position),\n      \"resizable\": true,\n      \"properties\": {\n        // Use simple direct values for properties\n        \n        // DYNAMICALLY GENERATED PROPERTIES FROM DATABASE\n        ${dynamicPropertiesSchema}\n      }\n    }\n\n    IMPORTANT RULES:\n    1. Every component MUST have a unique \"id\".\n    2. All properties MUST be simple direct values (string, number, boolean, or hex string for colors).\n    3. Colors MUST be Hex strings (e.g. \"#FF0000\" or \"#AARRGGBB\").\n    4. For any \"icon\" property, you MUST use ONLY one of these valid names: [${svgNamesList}].\n    5. Generate a complete, beautiful design based on the user prompt: \"${prompt}\".\n    6. Ensure components are positioned logically.\n    `;\n\n    let currentPrompt = schemaDescription;\n    let attempts = 0;\n    const maxAttempts = 3;\n    const modelName = \"gemini-flash-latest\";\n    // 1. Check Cache (Only for non-iterations)\n    if (!isIteration) {\n      try {\n        const cached = await db.select()\n          .from(aiDesignCache)\n          .where(eq(aiDesignCache.prompt, prompt))\n          .limit(1);\n\n        if (cached && cached.length > 0) {\n          const entry = cached[0];\n          if (entry) {\n            console.log(\"\uD83D\uDE80 Cache HIT for prompt:\", prompt);\n            return JSON.parse(entry.designJson);\n          }\n        }\n        console.log(\"\uD83C\uDF11 Cache MISS for prompt:\", prompt);\n      } catch (e) {\n        console.error(\"\u26A0\uFE0F Cache lookup error:\", e);\n      }\n    }\n\n    console.log(\"----------------------------------------------------------------\");\n    console.log(\"\uD83E\uDD16 GENERATED AI PROMPT:\");\n    console.log(currentPrompt);\n    console.log(\"----------------------------------------------------------------\");\n\n    while (attempts < maxAttempts) {\n      try {\n        console.log(`\uD83E\uDD16 AI Generation Attempt ${attempts + 1}/${maxAttempts}`);\n        console.log(\"\u23F3 Waiting for Gemini API response...\");\n        const result = await model.generateContent(currentPrompt);\n        console.log(\"\u2705 Received response from Gemini API\");\n\n        console.log(\"\u23F3 Extracting text from response...\");\n        const responseText = result.response.text();\n        console.log(\"\u2705 Text extracted\");\n\n        let json: any;\n        try {\n          console.log(\"\u23F3 Parsing JSON...\");\n          json = JSON.parse(responseText);\n          console.log(\"\u2705 JSON parsed successfully\");\n        } catch (e) {\n          console.error(\"\u274C Failed to parse JSON:\", responseText);\n          throw new Error(\"Invalid JSON returned by AI\");\n        }\n\n        // basic validation\n        const errors = this.validateDesignJson(json);\n        if (errors.length === 0) {\n          // 2. Save to Cache (ONLY for initial prompts, NOT for iterations or fixing prompts)\n          if (!isIteration && attempts === 0) {\n            try {\n              await db.insert(aiDesignCache).values({\n                id: ulid(),\n                prompt: prompt,\n                designJson: JSON.stringify(json),\n                modelUsed: modelName,\n              }).onConflictDoUpdate({\n                target: aiDesignCache.prompt,\n                set: { designJson: JSON.stringify(json), modelUsed: modelName }\n              });\n              console.log(\"\u2705 Saved to cache (initial successful attempt)\");\n            } catch (e) {\n              console.error(\"\u26A0\uFE0F Failed to save to cache:\", e);\n            }\n          } else if (attempts > 0) {\n            console.log(\"\u2139\uFE0F Skipping cache save for fixing prompt (attempt > 0)\");\n          } else if (isIteration) {\n            console.log(\"\u2139\uFE0F Skipping cache save for iteration prompt\");\n          }\n\n          // 3. Record in Session if provided\n          if (sessionId) {\n            try {\n              const db = getDrizzle();\n              // Ensure session exists\n              await db.insert(aiDesignSessions).values({ id: sessionId }).onConflictDoNothing();\n\n              // Record user prompt\n              await db.insert(aiDesignMessages).values({\n                id: ulid(),\n                sessionId: sessionId,\n                role: 'user',\n                content: prompt,\n              });\n\n              // Record AI response\n              await db.insert(aiDesignMessages).values({\n                id: ulid(),\n                sessionId: sessionId,\n                role: 'assistant',\n                content: JSON.stringify(json),\n              });\n              console.log(\"\u2705 Recorded messages in session:\", sessionId);\n            } catch (e) {\n              console.error(\"\u26A0\uFE0F Failed to record session message:\", e);\n            }\n          }\n\n          return json;\n        }\n\n        console.warn(\"\u26A0\uFE0F Validation Errors:\", errors);\n\n        // Add errors to prompt and retry\n        currentPrompt = `\n        The previous JSON had the following errors:\\n${errors.join('\\n')}\\n\n        Please fix these errors and return the valid JSON again.\n        Original Prompt: ${schemaDescription}\n        `;\n\n        attempts++;\n      } catch (error) {\n        console.error(\"\u274C AI Generation Error:\", error);\n        attempts++;\n        if (attempts < maxAttempts) {\n          console.log(\"Waiting 5 seconds before retry...\");\n          await new Promise(resolve => setTimeout(resolve, 5000));\n        }\n      }\n    }\n\n    throw new Error(\"Failed to generate valid design after multiple attempts\");\n  }\n\n  static async iterateDesign(sessionId: string, prompt: string): Promise<any> {\n    const db = getDrizzle();\n\n    // 1. Fetch History\n    const history = await db.select()\n      .from(aiDesignMessages)\n      .where(eq(aiDesignMessages.sessionId, sessionId))\n      .orderBy(asc(aiDesignMessages.createdAt));\n\n    if (history.length === 0) {\n      // If no history, just do a normal generation (which will be cached)\n      return this.generateDesign(prompt, sessionId, false);\n    }\n\n    // 2. Find last design\n    let lastDesignJson = \"\";\n    for (let i = history.length - 1; i >= 0; i--) {\n      const entry = history[i];\n      if (entry && entry.role === 'assistant') {\n        lastDesignJson = entry.content;\n        break;\n      }\n    }\n\n    // 3. Construct Contextual Prompt\n    const contextPrompt = `\n    The user is iterating on a previous design.\n    ${lastDesignJson ? `PREVIOUS DESIGN JSON:\\n${lastDesignJson}\\n` : ''}\n    \n    USER FEEDBACK / REQUEST:\n    \"${prompt}\"\n    \n    Based on the previous design and the user's feedback, provide an updated, corrected JSON.\n    Maintain the overall structure but apply the requested changes carefully.\n    `;\n\n    // 4. Generate using context (passed as isIteration: true to avoid caching)\n    return this.generateDesign(contextPrompt, sessionId, true);\n  }\n\n  static validateDesignJson(json: any): string[] {\n    const errors: string[] = [];\n\n    if (!json.components || !Array.isArray(json.components)) {\n      errors.push(\"Root object missing 'components' array\");\n      return errors; // Critical failure\n    }\n\n    json.components.forEach((comp: any, index: number) => {\n      if (!comp.type) errors.push(`Component[${index}] missing type`);\n\n      // Auto-parse x and y if they are strings\n      if (typeof comp.x === 'string') {\n        const parsed = parseFloat(comp.x);\n        if (!isNaN(parsed)) comp.x = parsed;\n      }\n      if (typeof comp.y === 'string') {\n        const parsed = parseFloat(comp.y);\n        if (!isNaN(parsed)) comp.y = parsed;\n      }\n\n      if (typeof comp.x !== 'number') errors.push(`Component[${index}] invalid x`);\n      if (typeof comp.y !== 'number') errors.push(`Component[${index}] invalid y`);\n\n      if (!comp.properties) {\n        errors.push(`Component[${index}] missing properties`);\n      } else {\n        // Auto-parse property values if they are strings that look like numbers\n        Object.keys(comp.properties).forEach(key => {\n          const val = comp.properties[key];\n          if (typeof val === 'string' && val.trim() !== '' && !isNaN(Number(val)) && !val.startsWith('#')) {\n            // If it's a numeric string and not a color hex, attempt to parse it\n            comp.properties[key] = parseFloat(val);\n          }\n        });\n      }\n    });\n\n    return errors;\n  }\n}\n", "import { pgTable, text, varchar, boolean } from 'drizzle-orm/pg-core';\r\nimport { ulidField, defaultDateFields } from './common';\r\n\r\nexport const svgs = pgTable('svgs', {\r\n    id: ulidField('id').primaryKey(),\r\n    name: varchar('name', { length: 255 }).notNull(),\r\n    svg: text('svg').notNull(),\r\n    type: varchar('type', { length: 50 }).notNull(), // 'regular', 'solid', 'brands'\r\n    isDefault: boolean('is_default').notNull().default(false),\r\n    ...defaultDateFields,\r\n});\r\n\r\nexport type Svg = typeof svgs.$inferSelect;\r\nexport type NewSvg = typeof svgs.$inferInsert;\r\n", "import { pgTable, text, varchar, index } from 'drizzle-orm/pg-core';\r\nimport { ulidField, defaultDateFields } from './common';\r\n\r\nexport const aiDesignCache = pgTable('ai_design_cache', {\r\n    id: ulidField('id').primaryKey(),\r\n    prompt: text('prompt').notNull().unique(),\r\n    designJson: text('design_json').notNull(),\r\n    modelUsed: varchar('model_used', { length: 255 }).notNull(),\r\n    ...defaultDateFields,\r\n}, (table) => {\r\n    return {\r\n        promptIndex: index('ai_design_cache_prompt_idx').on(table.prompt),\r\n    };\r\n});\r\n\r\nexport type AiDesignCache = typeof aiDesignCache.$inferSelect;\r\nexport type NewAiDesignCache = typeof aiDesignCache.$inferInsert;\r\n", "import { pgTable, text, varchar, timestamp, index, foreignKey } from 'drizzle-orm/pg-core';\r\nimport { ulidField, defaultDateFields } from './common';\r\n\r\nexport const aiDesignSessions = pgTable('ai_design_sessions', {\r\n    id: ulidField('id').primaryKey(), // Usually generated by frontend\r\n    ...defaultDateFields,\r\n});\r\n\r\nexport const aiDesignMessages = pgTable('ai_design_messages', {\r\n    id: ulidField('id').primaryKey(),\r\n    sessionId: ulidField('session_id').notNull().references(() => aiDesignSessions.id, { onDelete: 'cascade' }),\r\n    role: varchar('role', { length: 20 }).notNull(), // 'user' | 'assistant'\r\n    content: text('content').notNull(), // Prompt or JSON\r\n    createdAt: timestamp('created_at', { mode: 'date' }).notNull().defaultNow(),\r\n}, (table) => {\r\n    return {\r\n        sessionIdx: index('ai_design_messages_session_idx').on(table.sessionId),\r\n    };\r\n});\r\n\r\nexport type AiDesignSession = typeof aiDesignSessions.$inferSelect;\r\nexport type NewAiDesignSession = typeof aiDesignSessions.$inferInsert;\r\n\r\nexport type AiDesignMessage = typeof aiDesignMessages.$inferSelect;\r\nexport type NewAiDesignMessage = typeof aiDesignMessages.$inferInsert;\r\n", "import { defineRpc } from \"@arrirpc/server\";\r\nimport { a } from \"@arrirpc/schema\";\r\nimport { mediaServer } from \"../../services/mediaServer\";\r\nimport { AI_BASE_URL } from \"@env\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"GenerateImageParams\", {\r\n        prompt: a.string(),\r\n        negativePrompt: a.optional(a.string()),\r\n        width: a.optional(a.number()),\r\n        height: a.optional(a.number()),\r\n        steps: a.optional(a.number()),\r\n        socketId: a.optional(a.string()),\r\n    }),\r\n    response: a.object(\"GenerateImageResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n        url: a.optional(a.string()),\r\n    }),\r\n    handler: async ({ params }) => {\r\n        console.log(\"!!! [Backend RPC] generate_image HIT !!!\");\r\n        console.log(\"Params:\", JSON.stringify(params));\r\n        try {\r\n            const aiServerUrl = AI_BASE_URL || \"http://localhost:5000\";\r\n            const fullUrl = `${aiServerUrl}/generate-image`;\r\n            console.log(`\uD83D\uDD0C Connecting to AI server at: ${fullUrl}`);\r\n\r\n            // Set a long timeout (e.g., 5 minutes) for image generation\r\n            const controller = new AbortController();\r\n            const timeoutId = setTimeout(() => controller.abort(), 300000); // 300,000ms = 5 minutes\r\n\r\n            console.log(\"\u23F3 Waiting for AI server response...\");\r\n            const response = await fetch(fullUrl, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify({\r\n                    prompt: params.prompt,\r\n                    negative_prompt: params.negativePrompt || \"\",\r\n                    width: params.width || 512,\r\n                    height: params.height || 512,\r\n                    steps: params.steps || 25,\r\n                    socketId: params.socketId,\r\n                }),\r\n                signal: controller.signal,\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json().catch(() => ({}) as any);\r\n                throw new Error((errorData as any).error || `AI server returned ${response.status}`);\r\n            }\r\n\r\n            const imageBuffer = await response.arrayBuffer();\r\n            console.log(\"\u2705 Image received from AI server, size:\", imageBuffer.byteLength);\r\n\r\n            const uploadResult = await mediaServer.uploadMedia({\r\n                originalName: `generated-${Date.now()}.png`,\r\n                bytes: Buffer.from(imageBuffer),\r\n                contentType: \"image/png\",\r\n                directory: \"generated\",\r\n            });\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Image generated and uploaded successfully\",\r\n                url: uploadResult.url,\r\n            };\r\n        } catch (error: any) {\r\n            console.error(\"\u274C Image generation failed:\", error);\r\n            return {\r\n                success: false,\r\n                message: error.message || \"Unknown error occurred during image generation\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { defineRpc } from \"@arrirpc/server\";\r\nimport { a } from \"@arrirpc/schema\";\r\nimport { mediaServer } from \"../../services/mediaServer\";\r\nimport { AI_BASE_URL } from \"@env\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"InpaintImageParams\", {\r\n        prompt: a.string(),\r\n        negativePrompt: a.optional(a.string()),\r\n        width: a.optional(a.number()),\r\n        height: a.optional(a.number()),\r\n        steps: a.optional(a.number()),\r\n        socketId: a.optional(a.string()),\r\n        image: a.string(), // Base64 image or URL\r\n        mask: a.string(), // Base64 mask\r\n    }),\r\n    response: a.object(\"InpaintImageResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n        url: a.optional(a.string()),\r\n    }),\r\n    handler: async ({ params }) => {\r\n        console.log(\"!!! [Backend RPC] inpaint_image HIT !!!\");\r\n        try {\r\n            const aiServerUrl = AI_BASE_URL || \"http://localhost:5000\";\r\n            const fullUrl = `${aiServerUrl}/inpaint-image`;\r\n            console.log(`\uD83D\uDD0C Connecting to AI server at: ${fullUrl}`);\r\n\r\n            const controller = new AbortController();\r\n            const timeoutId = setTimeout(() => controller.abort(), 300000);\r\n\r\n            const response = await fetch(fullUrl, {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify({\r\n                    prompt: params.prompt,\r\n                    negative_prompt: params.negativePrompt || \"\",\r\n                    width: params.width || 512,\r\n                    height: params.height || 512,\r\n                    steps: params.steps || 25,\r\n                    socketId: params.socketId,\r\n                    image: params.image,\r\n                    mask: params.mask,\r\n                }),\r\n                signal: controller.signal,\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json().catch(() => ({}) as any);\r\n                throw new Error((errorData as any).error || `AI server returned ${response.status}`);\r\n            }\r\n\r\n            const imageBuffer = await response.arrayBuffer();\r\n\r\n            const uploadResult = await mediaServer.uploadMedia({\r\n                originalName: `inpainted-${Date.now()}.png`,\r\n                bytes: Buffer.from(imageBuffer),\r\n                contentType: \"image/png\",\r\n                directory: \"generated\",\r\n            });\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Image inpainted and uploaded successfully\",\r\n                url: uploadResult.url,\r\n            };\r\n        } catch (error: any) {\r\n            console.error(\"\u274C Image inpainting failed:\", error);\r\n            return {\r\n                success: false,\r\n                message: error.message || \"Unknown error occurred during image inpainting\",\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { defineRpc } from \"@arrirpc/server\";\r\nimport { a } from \"@arrirpc/schema\";\r\nimport { AiService } from \"../../services/aiService\";\r\n\r\nexport default defineRpc({\r\n    params: a.object({\r\n        sessionId: a.string(),\r\n        prompt: a.string(),\r\n    }),\r\n    response: a.object({\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n        data: a.any(),\r\n    }),\r\n    handler: async ({ params }) => {\r\n        try {\r\n            const resultJson = await AiService.iterateDesign(params.sessionId, params.prompt);\r\n            return {\r\n                success: true,\r\n                message: \"\",\r\n                data: resultJson,\r\n            };\r\n        } catch (error: any) {\r\n            console.error(\"\u274C Iterate Design Error:\", error);\r\n            return {\r\n                success: false,\r\n                message: error.message || \"Failed to iterate design\",\r\n                data: null,\r\n            };\r\n        }\r\n    },\r\n});\r\n", "import { a } from \"@arrirpc/schema\";\r\nimport { defineRpc } from \"@arrirpc/server\";\r\nimport { getDrizzle } from \"@database/postgres\";\r\nimport { svgs } from \"@database/schema/svgs\";\r\nimport { like, or, count, ilike, desc } from \"drizzle-orm\";\r\n\r\nexport default defineRpc({\r\n    params: a.object(\"GetSvgsParams\", {\r\n        limit: a.int32(),\r\n        offset: a.int32(),\r\n        search: a.string(),\r\n    }),\r\n    response: a.object(\"GetSvgsResponse\", {\r\n        success: a.boolean(),\r\n        message: a.string(),\r\n        total: a.int32(),\r\n        svgs: a.array(\r\n            a.object(\"SvgInfo\", {\r\n                id: a.string(),\r\n                name: a.string(),\r\n                svg: a.string(),\r\n                type: a.string(),\r\n            })\r\n        ),\r\n    }),\r\n    async handler({ limit, offset, search }) {\r\n        console.log(`[get_svgs] params: limit=${limit}, offset=${offset}, search=${search}`);\r\n        try {\r\n            const db = getDrizzle();\r\n            const pageSize = limit || 50;\r\n            const pageOffset = offset || 0;\r\n\r\n            let query = db.select().from(svgs).$dynamic();\r\n\r\n            if (search) {\r\n                const searchPattern = `%${search}%`;\r\n                query = query.where(\r\n                    or(\r\n                        ilike(svgs.name, searchPattern),\r\n                        ilike(svgs.type, searchPattern)\r\n                    )\r\n                );\r\n            }\r\n\r\n            // Get total count for pagination\r\n            // Clone query for count? database specific. \r\n            // Ideally we do a separate count query or use window function.\r\n            // For simplicity, let's just run a count query.\r\n\r\n            let countQuery = db.select({ count: count() }).from(svgs).$dynamic();\r\n            if (search) {\r\n                const searchPattern = `%${search}%`;\r\n                countQuery = countQuery.where(\r\n                    or(\r\n                        ilike(svgs.name, searchPattern),\r\n                        ilike(svgs.type, searchPattern)\r\n                    )\r\n                );\r\n            }\r\n\r\n            const totalResult = await countQuery;\r\n            const total = totalResult[0]?.count || 0;\r\n\r\n            const results = await query.limit(pageSize).offset(pageOffset).orderBy(desc(svgs.createdAt), desc(svgs.id));\r\n\r\n            return {\r\n                success: true,\r\n                message: \"Fetched SVGs successfully\",\r\n                total: total,\r\n                svgs: results.map(s => ({\r\n                    id: s.id,\r\n                    name: s.name,\r\n                    svg: s.svg,\r\n                    type: s.type\r\n                })),\r\n            };\r\n        } catch (error) {\r\n            console.error(\"Error fetching SVGs:\", error);\r\n            return {\r\n                success: false,\r\n                message: error instanceof Error ? error.message : \"Failed to fetch SVGs\",\r\n                total: 0,\r\n                svgs: [],\r\n            };\r\n        }\r\n    },\r\n});\r\n"],
  "mappings": "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",
  "names": ["fs", "path", "resolve", "fs", "path", "fs", "path", "fs", "join", "fs", "text", "join", "components", "a", "varchar", "varchar", "ulid", "db", "a", "defineRpc", "pgTable", "text", "varchar", "boolean", "pgTable", "varchar", "text", "boolean", "ulid", "resolve", "join", "dirname", "getProjectRoot", "defineRpc", "a", "db", "ulid", "a", "defineRpc", "defineRpc", "a", "db", "a", "defineRpc", "resolve", "defineRpc", "a", "db", "a", "defineRpc", "writeFile", "mkdir", "join", "resolve", "defineRpc", "a", "db", "a", "defineRpc", "eq", "defineRpc", "a", "db", "a", "defineRpc", "eq", "defineRpc", "a", "db", "eq", "defineRpc", "a", "pgTable", "text", "varchar", "boolean", "pgTable", "varchar", "text", "boolean", "pgTable", "text", "varchar", "pgTable", "text", "varchar", "pgTable", "text", "varchar", "timestamp", "index", "pgTable", "varchar", "text", "timestamp", "index", "eq", "ulid", "db", "resolve", "index", "defineRpc", "a", "defineRpc", "a", "defineRpc", "a", "defineRpc", "a", "defineRpc", "a", "defineRpc", "a", "defineRpc", "a", "a", "defineRpc", "desc", "defineRpc", "a", "db"]
}
